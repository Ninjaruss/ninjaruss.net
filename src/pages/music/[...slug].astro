---
import { getCollection } from 'astro:content';
import EntryLayout from '../../layouts/EntryLayout.astro';

export async function getStaticPaths() {
  const entries = await getCollection('music');
  return entries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

const meta: Record<string, string> = {};
if (entry.data.mood) {
  meta['Mood'] = entry.data.mood;
}
---

<EntryLayout
  title={entry.data.title}
  status={entry.data.status}
  emotional_tags={entry.data.emotional_tags}
  artifacts={entry.data.artifacts}
  backLink="/music"
  backLabel="Back to Music"
  meta={meta}
>
  <Content />

  {entry.data.tracks && entry.data.tracks.length > 0 && (
    <section class="tracklist">
      <h3>Tracks</h3>
      <ol>
        {entry.data.tracks.map((track) => (
          <li>
            <span class="track__title">{track.title}</span>
            <span class="track__artist">{track.artist}</span>
            {track.link && (
              <a href={track.link} target="_blank" rel="noopener noreferrer" class="track__link">
                Listen
              </a>
            )}
          </li>
        ))}
      </ol>
    </section>
  )}
</EntryLayout>

<style>
  .tracklist {
    margin-top: var(--space-2xl);
    padding-top: var(--space-xl);
    border-top: 1px solid var(--color-border);
  }

  .tracklist h3 {
    font-family: var(--font-display);
    font-size: var(--text-lg);
    margin-bottom: var(--space-md);
  }

  .tracklist ol {
    display: flex;
    flex-direction: column;
    gap: var(--space-sm);
    counter-reset: track;
  }

  .tracklist li {
    display: flex;
    align-items: baseline;
    gap: var(--space-sm);
    padding: var(--space-sm) 0;
    border-bottom: 1px solid var(--color-border);
    counter-increment: track;
  }

  .tracklist li::before {
    content: counter(track) ".";
    font-family: var(--font-mono);
    font-size: var(--text-sm);
    color: var(--color-muted);
    min-width: 2ch;
  }

  .track__title {
    font-weight: 500;
    color: var(--color-charcoal);
  }

  .track__artist {
    color: var(--color-muted);
    font-size: var(--text-sm);
  }

  .track__link {
    margin-left: auto;
    font-size: var(--text-xs);
    color: var(--color-gold-dark);
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
</style>
