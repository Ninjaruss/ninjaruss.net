---
import { getCollection } from 'astro:content';
import SplitViewLayout from '../../layouts/SplitViewLayout.astro';
import ListItem from '../../components/ListItem.astro';
import EntryHeader from '../../components/EntryHeader.astro';
import EntryBody from '../../components/EntryBody.astro';
import RelatedContent from '../../components/RelatedContent.astro';
import { stripMarkdown, hasMinimalContent } from '../../utils/content';
import { getAllCollections, getSortedEntries } from '../../utils/collections';

export async function getStaticPaths() {
  const entries = await getCollection('showcase');
  return entries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

const sortedShowcase = await getSortedEntries('showcase');
const { allMedia, allNotes, allShowcase } = await getAllCollections();
const hasContent = !hasMinimalContent(entry.body);
---

<SplitViewLayout
  title="Showcase"
  description="Projects framed as inquiries."
  section="showcase"
  initialSlug={entry.slug}
  initialEmblem={entry.data.emblem}
>
  <Fragment slot="list">
    {sortedShowcase.map((exp) => (
      <ListItem
        href={`/showcase/${exp.slug}`}
        slug={exp.slug}
        title={exp.data.title}
        tags={exp.data.tags}
        searchableContent={stripMarkdown(exp.body).slice(0, 500)}
        hasMinimalContent={hasMinimalContent(exp.body)}
      />
    ))}
  </Fragment>

  <Fragment slot="detail">
    <article class="entry">
      <div class="container">
        <EntryHeader
          title={entry.data.title}
          tags={entry.data.tags}
          publishedAt={entry.data.publishedAt}
          updatedAt={entry.data.updatedAt}
          emblem={entry.data.emblem}
        />
        <EntryBody hasContent={hasContent}>
          <Content />
        </EntryBody>
        {entry.data.collections.length > 0 && (
          <RelatedContent
            currentSlug={entry.slug}
            currentCollections={entry.data.collections}
            section="showcase"
            allMedia={allMedia}
            allNotes={allNotes}
            allShowcase={allShowcase}
          />
        )}
      </div>
    </article>
  </Fragment>
</SplitViewLayout>
